(()=>{"use strict";var s={167:s=>{s.exports=require("axios")},860:s=>{s.exports=require("express")},323:s=>{s.exports=require("mqtt")}},e={};function o(r){var t=e[r];if(void 0!==t)return t.exports;var c=e[r]={exports:{}};return s[r](c,c.exports,o),c.exports}(()=>{const s=o(167).create({baseURL:process.env.APLICATION_SERVER}),e=o(860),r=e(),t=o(323);r.use(e.json());const c=t.connect(process.env.MQTT_BROKER);c.on("connect",(()=>{console.log("Connected"),s.get("all-topic").then((s=>{s.data.forEach((s=>{c.subscribe(s,(e=>{e&&console.error("Error al suscribirse al topic:",s)}))})),res.status(200).send("OK")})).catch((s=>{console.error("Error al obtener la lista de tópicos:",s),res.status(500).send("Error al obtener la lista de tópicos")}))})),r.post("/subscribe",((s,e)=>{const{topic:o}=s.body;if(!o)return e.status(400).send("Debe proporcionar un topic");c.subscribe(o,(s=>{s?(console.error("Error al suscribirse al topic:",o),e.status(500).send("Error al suscribirse al topic")):(console.log("Suscrito al topic:",o),e.status(200).send("Suscrito al topic: "+o))}))})),r.post("/unsubscribe",((s,e)=>{const{topic:o}=s.body;if(!o)return e.status(400).send("Debe proporcionar un topic");c.unsubscribe(o,(s=>{s?(console.error("Error al desuscribirse del topic:",o),e.status(500).send("Error al desuscribirse del topic")):(console.log("Desuscripto del topic:",o),e.status(200).send("Desuscripto del topic: "+o))}))})),c.on("message",(function(e,o){console.log("Mensaje recibido en el topic:",e,"mensaje: ",o.toString());const r=JSON.parse(o.toString());s.post("validation-permission",r).then((s=>{"success"===s.data.status?c.publish(`${e}/escucha`,JSON.stringify(s.data)):console.log("El mensaje recibido no es proveniente de un lector valido")})).catch((s=>{console.error("Error al enviar la petición POST:",s)}))})),r.listen(process.env.PORT||3030,(function(){console.log(`Server listening on port ${process.env.PORT||3030}`)}))})()})();